在连续值预估（回归任务）中，损失函数用于衡量模型预测值与真实值之间的差异。以下是常见的回归损失函数及其公式、使用场景和特性对比：

---

### **1. 均方误差（Mean Squared Error, MSE）**
**公式**：  
<img width="1280" height="462" alt="image" src="https://github.com/user-attachments/assets/0490c7c4-1228-4cf1-9aab-a6061433bcaf" />

- **\(y_i\)**：真实值，**\(\hat{y}_i\)**：预测值，**\(N\)**：样本数。  
- **梯度**：\(\frac{\partial \text{MSE}}{\partial \hat{y}_i} = \frac{2}{N}(y_i - \hat{y}_i)\)。  

**特性**：  
- **对异常值敏感**：平方项会放大较大误差（如预测偏差 10 的损失是偏差 5 的 4 倍）。  
- **可微性**：处处可导，适合梯度下降优化。  
- **几何意义**：最小化预测值与真实值的欧氏距离平方。  

**使用场景**：  
- 默认回归损失函数，适用于误差分布近似正态、无显著异常值的任务。  
- 例如：房价预测、温度预测、股票价格趋势（假设数据分布平稳）。  

---

### **2. 平均绝对误差（Mean Absolute Error, MAE）**
**公式**：  
<img width="1356" height="380" alt="image" src="https://github.com/user-attachments/assets/8955dbaf-277d-4d91-beac-98e31aa1c3c4" />

- **梯度**：\(\frac{\partial \text{MAE}}{\partial \hat{y}_i} = \frac{1}{N} \cdot \text{sign}(y_i - \hat{y}_i)\)（在 \(y_i \neq \hat{y}_i\) 时为常数）。  

**特性**：  
- **鲁棒性**：对异常值不敏感（偏差 10 的损失与偏差 5 的损失线性相关）。  
- **不可微性**：在 \(y_i = \hat{y}_i\) 处不可导，但可通过亚梯度优化。  
- **几何意义**：最小化预测值与真实值的曼哈顿距离。  

**使用场景**：  
- 数据存在显著异常值或噪声时（如金融风控中的极端损失预测）。  
- 例如：能源消耗预测、用户行为时长预测（可能存在异常长或短的行为）。  

---

### **3. Huber Loss（平滑平均绝对误差）**
**公式**：  
<img width="1438" height="378" alt="image" src="https://github.com/user-attachments/assets/8e96412e-d8a4-4697-be73-b4a8052dc4c3" />

- **\(\delta\)**：阈值参数，控制从平方损失到线性损失的切换点。  

**特性**：  
- **结合 MSE 和 MAE 的优点**：  
  - 误差较小时（\(|\Delta| \leq \delta\)）为平方损失，可微且对小误差敏感。  
  - 误差较大时（\(|\Delta| > \delta\)）为线性损失，避免异常值主导梯度。  
- **超参数**：需调整 \(\delta\)（通常通过交叉验证）。  

**使用场景**：  
- 数据存在部分异常值，但希望模型仍关注小误差时。  
- 例如：自动驾驶中的距离预测、工业传感器数据校准。  

---

### **4. Log-Cosh Loss（对数双曲余弦损失）**
**公式**：  
<img width="1338" height="356" alt="image" src="https://github.com/user-attachments/assets/e5764c49-5b96-46fa-85d1-c80d1b818d7f" />

- **\(\cosh(x) = \frac{e^x + e^{-x}}{2}\)**，因此 \(\log(\cosh(x)) \approx \frac{x^2}{2}\)（当 \(x \to 0\) 时）。  

**特性**：  
- **平滑近似 MSE**：对小误差类似 MSE，对大误差增长比 MSE 慢（但比 MAE 快）。  
- **处处可微**：梯度为 \(\tanh(y_i - \hat{y}_i)\)，适合梯度下降。  
- **计算成本**：略高于 MSE/MAE（需计算指数函数）。  

**使用场景**：  
- 需要平滑损失且对异常值有一定鲁棒性的任务。  
- 例如：时间序列预测（如电力需求）、推荐系统中的评分预测。  

---

### **5. Quantile Loss（分位数损失）**
**公式**：  
<img width="1428" height="614" alt="image" src="https://github.com/user-attachments/assets/3d839441-2117-4ec1-aa0e-c164dd02d43f" />

- **\(\tau \in (0, 1)\)**：目标分位数（如 \(\tau=0.5\) 为中位数）。  
- 等价于：  
  \[
  \text{Loss} = 
  \begin{cases} 
  \tau (y_i - \hat{y}_i) & \text{if } y_i \geq \hat{y}_i, \\
  (\tau - 1)(y_i - \hat{y}_i) & \text{otherwise}.
  \end{cases}
  \]

**特性**：  
- **预测分位数**：可同时训练多个模型预测不同分位数（如 10%、90% 置信区间）。  
- **不对称损失**：通过调整 \(\tau\) 惩罚高估或低估（如 \(\tau=0.9\) 更重视高估误差）。  

**使用场景**：  
- 需要风险敏感预测的任务（如金融中的 VaR 计算、库存管理中的安全库存预测）。  
- 例如：天气预报中的降雨量区间预测、物流中的运输时间预测。  

---

### **6. Tweedie Loss（广义线性模型损失）**
**公式**：  
<img width="1514" height="632" alt="image" src="https://github.com/user-attachments/assets/c79b53a2-7760-4b78-a0db-9459e2cff213" />

- **\(\rho \in (-\infty, 0) \cup (0, 1)\)**：控制分布形状（如 \(\rho=1\) 为泊松，\(\rho=2\) 为伽马）。  

**特性**：  
- **适用于零膨胀数据**：如保险索赔（大量零值 + 少量大值）。  
- **结合泊松和伽马分布**：\(\rho\) 调节对零值和长尾的敏感度。  

**使用场景**：  
- 零膨胀连续值预测（如客户消费金额、医疗费用）。  
- 例如：电商用户购买金额预测、保险索赔金额建模。  

---

### **对比总结**
| 损失函数       | 公式形式               | 优点                          | 缺点                          | 典型场景                     |
|----------------|------------------------|-------------------------------|-------------------------------|------------------------------|
| **MSE**        | \((y-\hat{y})^2\)      | 可微，对小误差敏感            | 对异常值敏感                  | 默认回归，数据分布平稳       |
| **MAE**        | \(|y-\hat{y}|\)        | 鲁棒，对异常值不敏感          | 不可微，优化较慢              | 存在异常值的数据              |
| **Huber**      | 分段函数（MSE+MAE）    | 结合两者优点，平滑过渡        | 需调参 \(\delta\)             | 部分异常值，关注小误差       |
| **Log-Cosh**   | \(\log(\cosh(y-\hat{y}))\) | 平滑，处处可微              | 计算成本高                    | 需要平滑损失的场景           |
| **Quantile**   | 分位数不对称损失        | 可预测区间，风险敏感          | 需训练多个模型                | 风险评估，区间预测           |
| **Tweedie**    | 广义指数族损失          | 适合零膨胀+长尾数据          | 需调参 \(\rho\)，复杂度高     | 保险索赔、客户消费金额       |

---

### **选择建议**
1. **默认选择**：从 MSE 开始，若异常值影响大则换 Huber 或 MAE。  
2. **需要区间预测**：用 Quantile Loss。  
3. **零膨胀数据**：尝试 Tweedie Loss。  
4. **计算资源有限**：优先 MSE/MAE，避免 Log-Cosh/Tweedie。  

根据数据分布和业务需求灵活选择，并通过交叉验证验证效果。
